---
sudo: required
dist: trusty
env:
  matrix:
    - IMAGES="ubuntu:16.04"
    - IMAGES="ubuntu:14.04"
    - IMAGES="ubuntu:latest"
language: python
python: "2.7"
before_install:
  - sudo apt-get update -qq
install:
  - echo "TRAVIS_ENV_VARS:" >&2
  - env | egrep -q TRAVIS | sort -u | sed -re "s/^/  /g" >&2
  - |
    if [[ "${TRAVIS_PULL_REQUEST}" != "false" ]];then
        echo "Is a travis pull request" >&2
        CORPUSOPS_BRANCH="$(git log HEAD|head -n1|awk '{print $2}')"
    else
        echo "Is not a travis pull request" >&2
        CORPUSOPS_BRANCH="${TRAVIS_BRANCH}"
    fi
    echo "Pinning corpusops to branch/changeset: ${CORPUSOPS_BRANCH}" >&2
    export CORPUSOPS_BRANCH
    bin/install.sh -C -S -b ${CORPUSOPS_BRANCH}
script:
  - |
    if [[ "${TRAVIS_PULL_REQUEST}" != "false" ]];then
        echo "Is a travis pull request" >&2
        CORPUSOPS_BRANCH="$(git log HEAD|head -n1|awk '{print $2}')"
    else
        echo "Is not a travis pull request" >&2
        CORPUSOPS_BRANCH="${TRAVIS_BRANCH}"
    fi
    export CORPUSOPS_BRANCH
    hacking/test_script
after_success:
  - DEBUG=1 hacking/docker_release
